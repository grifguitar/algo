# Практика 6. Строки: префикс и z-функция, хеши (11 октября)

Группа 3, преп. Хлытин Григорий

### Используемые обозначения:

Определение: *__новый термин__*

* `s` – строка
* `|s|` – длина строки
* `t` – *__подстрока__* строки 𝑠, если `∃ l, r: t = s[l : r)`
* `s[l : r)` и `s[l : r]` – подстроки (правая граница не включительно и включительно соответственно)
* `s[0 : i)` – *__префикс__* строки
* `s[i : |s|)` – *__суффикс__* строки
* `Σ` – алфавит
* `|Σ|` – размер алфавита

Здесь и далее будем считать, что индексация строк с нуля.

## 1. gcd – тоже период!

*__Период__* строки 𝑠 – число 𝑥, такое что 𝑠 является префиксом строки `s[0 : x)∞`. Период называется *__целым__*,
если `|𝑠| ⁝ 𝑥`. Пусть у строки 𝑠 есть периоды `𝑎, 𝑏 ≤ |𝑠| / 2`. Докажите, что gcd(𝑎, 𝑏) – тоже период.

### Решение:

Рассмотрим строку 𝑠, у которой есть периоды `𝑎, 𝑏` (без ограничения общности скажем `𝑎 ≤ 𝑏`):

Пример:

```haskell
s := "A B C D A B C D A B C D"  -- период 𝑎 = 4
s := "A B C D E F A B C D E F"  -- период 𝑏 = 6
```

Распишем определение *__периода__* равного _k_:

```haskell
s[i] = s[i + k], for all i
```

В нашей задаче по условию:

```haskell
1. s[i] = s[i + b], for all i
2. s[i] = s[i + a], for all i
Therefore
3. s[i] = s[i + b - a], for all i
```

Таким образом, рассматривая пару периодов (𝑏, 𝑎), мы можем перейти к рассмотрению пары (𝑎, 𝑏 - 𝑎)

Что это напоминает? Правильно, алгоритм Евклида нахождения наибольшего общего делителя. Заметим, что мы всегда уменьшаем
пару, поэтому этот процесс гарантированно завершится и мы получим, что gcd(𝑎, 𝑏) – тоже период строки 𝑠.

## 2. В поисках периода

* Найти кратчайший период строки тремя способами: 𝜋-функции, Z-функция, хеши.
* Найти все периоды строки.

### Теор. справка:

Определим **_функцию_ 𝜋0** от строки 𝑠: 𝜋0(𝑠) – длина максимального **_собственного_** (не совпадающего со всей
строкой) префикса 𝑠, совпадающего c суффиксом 𝑠.

Пример:

```haskell
𝜋0("A B C A B")   = 2  -- т.к. макс. собственный префикс, совпадающий с суфиксом, это подстрока "A B"
𝜋0("A B A B A B") = 4  -- т.к. макс. собственный префикс, совпадающий с суфиксом, это подстрока "A B A B"
𝜋0("A")           = 0  -- т.к. не существует собственного префикса, совпадающего с суфиксом
𝜋0("A A A A")     = 3  -- т.к. макс. собственный префикс, совпадающий с суфиксом, это подстрока "A A A"
```

Теперь определим **_префикс-функцию_** строки 𝑠: 𝜋(𝑠) – массив 𝜋 длины |𝑠| + 1, такой что:

* `𝜋[0] = -1`
* `𝜋[i] = 𝜋0( 𝑠[0 : i) ), for all i`

Пример:

```haskell
s := "A A B A A A B"            -- тогда 𝜋 = [-1, 𝜋0("A"), 𝜋0("A A"), 𝜋0("A A B"), ... , 𝜋0("A A B A A A B")]
𝜋 := [-1, 0, 1, 0, 1, 2, 2, 3]  -- массив префикс-функции, 𝜋[i] - значение функции 𝜋0 для префикса длины i
```

### Решение:

Рассмотрим строку 𝑠, у которой есть период:

Пример:

```haskell
s := "A A B B A A B B A A B B A A B B"  -- периоды 𝑎 = 4, 𝑏 = 8
```

**Лемма 1**. Заметим, что высказывания **(1)** и **(2)** равносильны:

1. Существует период длины 𝑎
2. Суффикс `𝑠[𝑎 : |𝑠|)` равен префиксу `𝑠[0 : |𝑠| - 𝑎)`

Докажем это утверждение:

> `=>`
>
> Так как есть период длины 𝑎:
>
> Сдвигаем подстроку `𝑠[𝑎 : |𝑠|)` на 𝑎 влево, получаем в точности подстроку `𝑠[0 : |𝑠| - 𝑎)`

> `<=`
>
> Обратное утверждение чуть менее очевидно.
> Так как условие **(2)** выполняется, то:
> ```haskell
> s[0 + i] = s[𝑎 + i], for all i in [0, |𝑠| - 𝑎)
> ```
> а это в точности соответствует определению _периода_ из предыдущей задачи.

Заметим, что *__целый__* период 𝑎 строки 𝑠 удовлетворяет условию: `𝑎 ≤ |𝑠| / 2` (по определению).

Теперь, для нахождения _минимального_ по длине периода, нам осталось найти _максимальный_ по длине
суффикс `𝑠[i : |𝑠|)`, который равен префиксу `𝑠[0 : |𝑠| - i)` и воспользоваться **Леммой 1**.

Длина такого макс. суффикса как раз была посчитана в массиве префикс-функции `𝜋[|𝑠|]` (значение функции 𝜋0 для всей
строки 𝑠). Осталось найти длину _кратчайшего_ периода `𝑎 = |𝑠| - 𝜋[|𝑠|]` (разность длины всей строки 𝑠 и длины
макс. собственного суффикса строки 𝑠, совпадающего с префиксом строки 𝑠).

**Упражнение**: при каких условиях числа `|𝑠| - 𝜋[𝜋[|𝑠|]]`, `|𝑠| - 𝜋[𝜋[𝜋[|𝑠|]]]`, `|𝑠| - 𝜋[𝜋[𝜋[𝜋[|𝑠|]]]]`
, ... , являются периодами?